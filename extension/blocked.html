<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stay Focused | ZenFlow ðŸŒ¿</title>
    <link rel="stylesheet" href="blocked.css">
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="icon-header">
                <span class="emoji">ðŸ§˜</span>
            </div>
            
            <h1 class="title">Stay focused, friend.</h1>
            <p class="subtitle">
                <span id="siteName" class="site-badge">This site</span> is blocked during your focus session.
            </p>

            <div class="timer-box">
                <div class="timer-label">Time remaining in session</div>
                <div id="timer" class="timer-value">--:--</div>
            </div>

            <div class="actions">
                <button id="goBack" class="btn btn-primary">Go back to work</button>
                <button id="endSession" class="btn btn-secondary">End session early</button>
            </div>

            <p class="quote">"Focus is a matter of deciding what things you're not going to do."</p>
        </div>
    </div>

    <script>
        // Get site name from URL
        const urlParams = new URLSearchParams(window.location.search);
        const site = urlParams.get('site');
        if (site) {
            document.getElementById('siteName').textContent = site;
        }

        // Back button
        document.getElementById('goBack').onclick = () => {
            window.history.back();
            // If No back history, close tab
            setTimeout(() => {
                if (window.location.href.includes('blocked.html')) {
                    window.close();
                }
            }, 100);
        };

        // End session button
        document.getElementById('endSession').onclick = () => {
            if (confirm('Are you sure you want to end your focus session early?')) {
                chrome.runtime.sendMessage({ action: 'stopFocus' }, () => {
                    // Refresh current page to original site
                    if (site) {
                        window.location.href = `https://${site}`;
                    } else {
                        window.close();
                    }
                });
            }
        };

        // Update timer
        function updateTimer() {
            chrome.storage.local.get(['focusState'], (result) => {
                if (result.focusState && result.focusState.isActive) {
                    const state = result.focusState;
                    const elapsed = Math.floor((Date.now() - state.startedAt) / 1000);
                    const remaining = Math.max(0, state.totalDuration - elapsed);
                    
                    const mins = Math.floor(remaining / 60);
                    const secs = remaining % 60;
                    document.getElementById('timer').textContent = 
                        `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                    
                    if (remaining <= 0) {
                        window.location.href = `https://${site}`;
                    }
                } else {
                    // Not active anymore, redirect back
                    if (site) window.location.href = `https://${site}`;
                }
            });
        }

        setInterval(updateTimer, 1000);
        updateTimer();
    </script>
</body>
</html>
